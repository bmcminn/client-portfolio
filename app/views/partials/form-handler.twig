<script>
    (function($) {
        var $form = $('form');

        $form.on('submit', function(e) {
            e.preventDefault();

            $inputs = $form.find('input, select');

            var formData = {};

            $inputs.each(function(index, input) {

                let $self = $(input);

                formData[$self.attr('name')] = $self.val();
            });

            var $notice = $form.find('[name="notice"]');


            $.post(
                $form.attr('action')
            ,   formData
            ,   function(data, res) {

                    // reset error fields
                    $notice.addClass('is-hidden');
                    $form.find('input').removeClass('is-danger');
                    $('.help').html('');

                    if (data.redirect) {
                        window.location = data.redirect;

                    } else {
                        Object.keys(data).forEach(function(field, index) {
                            if (field === 'notice') {
                                return;
                            }
                            $('[name="' + field + '"]')
                                .addClass('is-danger')
                                .next()
                                .html(data[field])
                                ;
                        });

                        if (data.notice) {
                            $notice
                                .removeClass('is-hidden')
                                .addClass('is-' + data.notice.level)
                                .text(data.notice.message)
                                ;

                            if ($notice.attr('data-animate') !== '') {
                                animateNotice($notice);
                            }
                        }
                    }
                }
            );

        });


        function animateNotice($target) {
            var classList       = $target.attr('data-animate') + ' animated';
            var eAnimationEnd   = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
            $target
                .addClass(classList)
                .one(eAnimationEnd, function() {
                    $(this).removeClass(classList);
                })
            ;
        }


    })(jQuery);
</script>


